# ==============================================================================
#  PTEKWPDEV — Developer Tasks / TODO
#  File: cp_devtasks.txt
#
#  Purpose:
#    Centralized list of outstanding development tasks for the PTEKWPDEV
#    platform. These tasks are architectural, tooling, or contributor‑experience
#    improvements that should be implemented in upcoming iterations.
#
#  Notes:
#    - This file is intentionally simple and text‑based.
#    - Tasks should be explicit, actionable, and contributor‑safe.
#    - [ ] TODO, [?] Investigate, [X] Done
# ==============================================================================

[ ] Add Makefile targets for dev_sources
      - Targets should wrap project_dev_sources.sh
      - Include: add-dev-plugin, add-dev-theme, list-dev-sources (future)

[ ] Add validation tooling for dev_sources
      - Validate local paths exist
      - Validate remote git URLs are reachable
      - Validate type=local|remote
      - Validate init_git is boolean
      - Add a project_dev_sources.sh --validate action

[ ] Convert PROJECT_BASE into a git repo and initialize each dev_source as a child git repo
      - Initialize PROJECT_REPO with git init during project_create
      - Initialize each dev_source directory as its own git repo during provisioning
      - For remote dev_sources:
            - If init_git=true, keep upstream .git
            - If init_git=false, strip .git and re-init as local repo
      - Add .gitignore templates for project repos and dev_source repos
      - Evaluate whether nested repos or submodules best fit long-term architecture
      
[ ] Integrate project_create and project_dev_sources into the demo lifecycle
      - project_create should detect demo and explain its role
      - project_dev_sources should offer template sources for demo
      - README should show full lifecycle including both tools
      - Ensure demo remains metadata-only until contributor runs lifecycle
      - demo project.json values in app_base/docs/cp_demo_projects.json

[X] Update app_deploy to generate projects.json with empty "projects" node
      - Remove demo project initialization
      - Ensure no auto-insertion of demo metadata
      - Confirm project_create is now required for demo lifecycle

[X] Confirm app_deploy no longer inserts demo metadata
      - projects.json must contain only { "projects": {} }
      - demo project must be created manually via project_create

[?] Improve app_deploy projects.json preservation logic
      - Current rule: do not overwrite if projects.json exists
      - Future rule: validate JSON structure before deciding to preserve
      - Regenerate only if:
            * file is missing
            * file is invalid JSON
            * file is missing required keys
            * schema version mismatch (future)
      - Preserve contributor-created metadata in all other cases

[X] Confirm project_create.sh treats demo like any other project
      - No special-case logic required
      - Demo must be created manually by contributors
      - Demo lifecycle remains fully explicit and hands-on

[ ] Add support for safe shell-style path expansion in app_config.sh
      - Allow $HOME and ~ expansion
      - Ensure expansion happens only for known path keys
      - Validate expanded paths are absolute
      - Preserve contributor safety (no eval of arbitrary content)
      - Add schema validation to reject unsupported patterns

[ ] Upgrade app_bootstrap.sh to accept arguments or prompt for config_base and project_base
      - Support flags: --config-base <path>, --project-base <path>
      - Support interactive prompts when values are missing
      - Validate that both paths are absolute (no $HOME, no ~)
      - Create directories only after confirmation
      - Write updated values into APP_BASE/app/config/app.json before copying to CONFIG_BASE
      - Ensure WHAT-IF mode is supported for safety
      - Update lifecycle documentation once implemented

[ ] Reinstate JSON Schema validation for app.json
      - Current validation disabled due to Ajv meta-schema fetch failures.
      - Requires offline-safe, deterministic validation using locally bundled Draft-07 meta-schema.
      - Steps:
            1. Bundle draft-07 meta-schema under app/config/schema/meta/
            2. Update validate_schema() to use --strict=false or --meta=false
            3. Ensure Ajv never fetches remote schemas (no network dependency)
            4. Re-enable validate_schema "$json_content" in write_app_json()
      - Priority: Medium (bootstrap works without it)
      - Owner: Craig

[ ] app_deploy: Implement automatic backup/archive of JSON config files
---------------------------------------------------------------------------
      Before app_deploy overwrites any JSON configuration file inside
      CONFIG_BASE/config (e.g., app.json, projects.json, environments.json),
      the script must create a timestamped backup/archive copy.

      Rationale:
      - Prevent accidental loss of contributor-created or user-specific config.
      - Ensure all overwrites are reversible and auditable.
      - Maintain deterministic, contributor-safe deployment flows.
      - Aligns with the repo-wide philosophy of explicit, non-destructive tooling.

      Suggested approach:
      - Before writing or copying a JSON file, check if it exists.
      - If it exists, copy it to CONFIG_BASE/config/archive/<filename>.<timestamp>.json
      - Log the backup action in the app_deploy log.
      - Proceed with overwrite only after successful backup.

[ ] output.sh:
      Add shorthand options for --truncate
    - Introduce -t as the canonical truncate flag
    - Ensure long form (--truncate) remains supported for clarity

      Add HEADER as an option instead of positional argument
    - Replace positional header argument with --doc-head / -d
    - Update usage text and internal parsing accordingly
    - Maintain backward compatibility only if necessary

      Make --append the default action
    - Remove --append flag entirely
    - Default behavior becomes append mode
    - Truncate only when -t / --truncate is explicitly provided

[ ] Make expected assets subdirectories config-driven in assets_healthcheck.sh

[ ] Make assets compose file use an .env which should match config entries in 
      app/config/app.config -> app/config/app.json
            assets.volume_name
            assets.container
            assets.root_path

# Add new tasks below this line