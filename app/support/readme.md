# âœ… **`app_base/app/support/README.md`**

```markdown
# PTEKWPDEV â€” Support Layer

The `app/support` directory contains the shared tooling, templates, and
metaâ€‘operations used by the PTEKWPDEV bootstrap environment. These files are not
part of the runtime application; instead, they provide deterministic,
contributorâ€‘safe scaffolding for generating and validating scripts across the
toolchain.

All templates in this directory follow the mutationâ€‘aware wrapper pattern:

```bash
# ====Name>>================================================
# Generated Code, modify with caution
...
# ====<<Name===============================================
```

These markers allow the `script_*` utilities to detect, inject, validate, and
repair generated blocks without risk of drift or contributor edits.

---

## ðŸ“ Template Files

All templates live in:

```
app/support/templates/
```

Each template provides a selfâ€‘contained block of logic that can be injected into
generated scripts by the `script_*` utilities.

### **1. `template.error.sh`**
Provides the canonical errorâ€‘handling block:

- timestamped error output  
- redâ€‘colored error messages  
- ERR trap with failing command  
- EXIT trap restoring working directory  
- `ptek_err()` namespaced error function  

Used when `script_new.sh` or other generators are invoked with `-e`.

---

### **2. `template.output.sh`**
Provides the logging subsystem loader:

- resolves `PTEK_APP_BASE`  
- loads `lib/output.sh`  
- validates presence of the logging library  
- defines default logfile behavior  

Used when generators include logging (`-l`).

---

### **3. `template.helpers.sh`**
Provides helperâ€‘function loading:

- resolves `PTEK_APP_BASE`  
- loads `lib/helpers.sh`  
- validates presence of helper library  

Used when generators include helpers (`-u`).

---

### **4. `template.app_config.sh`**
Provides applicationâ€‘level configuration:

- loads `lib/app_config.sh`  
- defines `PTEKWPCFG[]` dictionary  
- exposes `appcfg()` accessor  

Used when generators include appâ€‘config (`-a`).

---

### **5. `template.prj_config.sh`**
Provides projectâ€‘level configuration:

- loads `lib/project_config.sh`  
- defines `PTEKPRCFG[]` dictionary  
- exposes `prjcfg()` accessor  

Used when generators include projectâ€‘config (`-p`).

---

## ðŸ›  Script Generators

The `app/support/bin` directory contains metaâ€‘scripts that consume these
templates. Examples include:

- `script_new.sh`  
- `script_header_apply.sh`  
- `script_header_fix.sh`  
- `script_header_check.sh`

These tools:

1. Load templates from `app/support/templates/`
2. Inject them into generated scripts inside DOâ€‘NOTâ€‘EDIT blocks
3. Maintain deterministic, contributorâ€‘safe script structure
4. Enforce canonical include ordering and mutationâ€‘aware behavior

---

## ðŸ”’ Mutationâ€‘Aware Blocks

All generated include blocks are wrapped in:

```
# ========================================================================
# DO NOT EDIT THIS BLOCK â€” generated by <tool>
# To modify includes, re-run the generator with updated flags.
# ========================================================================
```

This ensures contributors never handâ€‘edit generated logic and can always
regenerate scripts safely.

---
## ðŸ“Œ Flow Diagram

                          +-----------------------------+
                          |     app/support/templates   |
                          |-----------------------------|
                          |  template.error.sh          |
                          |  template.output.sh         |
                          |  template.helpers.sh        |
                          |  template.app_config.sh     |
                          |  template.prj_config.sh     |
                          +--------------+--------------+
                                         |
                                         |  (selected via flags)
                                         v
                          +-----------------------------+
                          |   app/support/bin           |
                          |   Script Generators         |
                          |-----------------------------|
                          |  script_new.sh              |
                          |  script_header_apply.sh     |
                          |  script_header_fix.sh       |
                          |  script_header_check.sh     |
                          +--------------+--------------+
                                         |
                                         |  (inject templates into
                                         |   DO-NOT-EDIT blocks)
                                         v
                     +------------------------------------------------+
                     |        Generated Contributor Scripts           |
                     |------------------------------------------------|
                     |  ./bin/*.sh                                    |
                     |  ./app/support/bin/*.sh (generated variants)   |
                     |                                                |
                     |  - contain mutation-aware include blocks       |
                     |  - include deterministic template content      |
                     |  - safe to regenerate, not safe to hand-edit   |
                     +------------------------------------------------+
---

## ðŸ“Œ Notes for Contributors

- Do **not** edit template files unless you intend to update all generated
  scripts.
- Do **not** edit generated include blocks inside scripts; re-run the generator
  instead.
- All support scripts assume strict mode (`set -Eeuo pipefail`) and deterministic
  `APP_BASE` resolution.

---

## ðŸ“„ License

See the root repository for licensing details.
```
